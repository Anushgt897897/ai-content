import{p as o,c as n,n as i}from"./routes-f9ccf71d.js";const s="analyzeSelection";chrome.contextMenus.onClicked.addListener(({menuItemId:e,selectionText:t},c)=>{if(e===s){if(!c?.id)throw new Error("No tab found for selection");chrome.tabs.sendMessage(c.id,{type:"contextAnalyzeSelection",selectionText:t})}});chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:s,contexts:["selection"],title:"Analyze Selected Text with Polygraf AI"})});chrome.runtime.setUninstallURL(o.unInstall);chrome.runtime.onInstalled.addListener(e=>{e.reason==="install"&&(chrome.tabs.create({url:o.welcome}),chrome.tabs.create({url:chrome.runtime.getURL("src/pages/auth/index.html")}))});chrome.runtime.onMessage.addListener(({type:e,...t},c,r)=>(e==="auth_check"?n().then(a=>r({type:"auth_check_response",authed:a})):e==="set_access_token"?chrome.storage.local.set({access:t.access}).then(()=>r({type:"set_access_token_ack"})):e==="set_refresh_token"?chrome.storage.local.set({refresh:t.refresh}).then(()=>r({type:"set_refresh_token_ack"})):e==="get_token"?chrome.storage.local.get(["access","refresh"],a=>r({type:"get_token_response",tokens:a})):e==="remove_token"?chrome.storage.local.remove(["access","refresh"]).then(()=>r({type:"remove_token_ack"})):e==="get_config"?chrome.storage.local.get("config").then(({config:a})=>{r({type:"config",config:a?JSON.parse(a):null})}):e==="set_config"?chrome.storage.local.set({config:JSON.stringify(t.config)}).then(()=>r({type:"config",config:t.config})):e==="auth_notif"?h(t).catch(a=>{r({error:a})}).finally(()=>r({type:"auth_notif_ack"})):e==="cross_auth_req"&&chrome.storage.local.get(["access","refresh"],a=>r({type:"cross_auth_res",tokens:a})),!0));async function h(e){await chrome.runtime.sendMessage("efpjnlhbndlphomipnbbeihgigonbpba",{type:"cross_auth_notif",tokens:e}).catch(null),l(),await new Promise(c=>setTimeout(c,500));const t=new URL("https://polygraf.ai");t.pathname="/account",t.searchParams.append("tab","ai_extension"),chrome.tabs.create({url:t.href})}async function l(){const e=new URL("https://polygraf.ai");e.pathname="/auth/sync-login";const t=await chrome.tabs.create({url:e.href});t.id&&(await new Promise(c=>setTimeout(c,1e4)),await chrome.tabs.remove(t.id).catch(console.error))}chrome.runtime.onMessageExternal.addListener(({type:e,...t},c,r)=>(e==="cross_auth_notif"&&chrome.storage.local.set({access:t.access,refresh:t.refresh}).then(()=>i(!0).then(()=>r({type:"cross_auth_notif_ack"}))),!0));
